window.appfail=window.appfail||{};appfail.reporting=(function(){var x=function(){function H(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}return(H()+H()+"-"+H()+"-"+H()+"-"+H()+"-"+H()+H()+H())};var r={slug:null,processInterval:4,daysToStore:7,onBeforeStore:null,appfailApiRoot:"https://api.appfail.net"};var A={RequestUrl:"",HttpVerb:"",ReferrerUrl:document.referrer,OccurrenceTimeUtc:null,User:"Anonymous",PostValuePairs:[],QueryValuePairs:[],Cookies:[],UniqueId:null,UserAgent:navigator.userAgent,HttpStatus:null,Exceptions:[],PageCorrelationId:x(),IsXHRFailure:false,XHRRequestURL:null,ConnectionStatus:"online",IsStandalone:false,TimeOnPage:0};var o={ExceptionType:"Javascript Error",ExceptionMessage:"",StackTrace:""};var C={};var w=[];var i;var F=("ononline" in window&&"onoffline" in window)?true:false;var B=("JSON" in window)?true:false;var y=("localStorage" in window)?true:false;var u=new Date();var c=false;var q=null;var E=false;var v=c?false:(typeof navigator.onLine==="boolean")?true:false;var a=function(I){var J=!I?null:(I instanceof Array?[]:{});for(var H in I){if(typeof(I[H])==="object"){J[H]=a(I[H])}else{J[H]=I[H]}}return J};var l=function(L,K){var I={};for(var J in L){if(L.hasOwnProperty(J)){I[J]=L[J]}}for(var H in K){if(K.hasOwnProperty(H)){I[H]=K[H]}}return I};var f=function(H){if(E&&typeof console==="object"){console.log(H)}};var n=function(J,K,I){if(J.addEventListener){J.addEventListener(K.replace(/^on/,""),I,false)}else{if(J[K]){var H=J[K];J[K]=function(L){H(L);I(L)}}else{J[K]=function(L){I(L)}}}};(function(I){var J=I.prototype.send;I.prototype.send=function(N){var L=this;var M;var K=function(){if(L.readyState===4){f(L);var O=L.appfailData;if(L.status&&L.status>=400){b({ReadyState:L.readyState,Status:L.status,StatusText:L.statusText,Method:O?O.method:null,Url:O?O.url:null})}}if(M){M()}};if(this.addEventListener){this.addEventListener("readystatechange",K,false)}else{M=this.onreadystatechange;this.onreadystatechange=K}J.call(this,N)};var H=I.prototype.open;I.prototype.open=function(M,K,L){this.appfailData={method:M,url:K};H.call(this,M,K,L)}})(XMLHttpRequest);var d=function(){n(window,"onerror",function(J,I,H){p(J,I,H);return true});i=window.setInterval(function(){if(w.length){h()}},C.processInterval*1000);if(F){n(window,"ononline",function(){e();h()})}};var G=function(){return(new Date()-u)};var t=[];(function(){var H,J=/\+/g,I=/([^&=]+)=?([^&]*)/g,L=function(M){return decodeURIComponent(M.replace(J," "))},K=window.location.search.substring(1);H=I.exec(K);while(H){t.push([L(H[1]),L(H[2])]);H=I.exec(K)}})();var m=function(H){H.RequestUrl=q?q:document.location.href;if(!H.OccurrenceTimeUtc){H.OccurrenceTimeUtc=new Date().getTime()}H.UniqueId=x();H.TimeOnPage=G();H.UserAgent=navigator.userAgent;H.Cookies=[];H.ReferrerUrl=document.referrer;H.QueryValuePairs=t};var p=function(K,J,I){f(K,J,I);var H=a(A);H.OccurrenceTimeUtc=(K&&K.timeStamp)?new Date(K.timeStamp).getTime():null;var L=a(o);L.ExceptionMessage=K.message;L.StackTrace=K.filename+" --- line "+K.lineno;H.Exceptions.push(L);m(H);if(C.onBeforeStore){C.onBeforeStore(H)}w.push(H)};var b=function(I){f(I);if(!I.Url){return}var H=a(A);H.XHRRequestUrl=I.Url;H.IsXHRFailure=true;H.HttpStatus=I.Status;H.HttpVerb=I.Method;m(H);if(C.onBeforeStore){C.onBeforeStore(H)}w.push(H)};var k=function(I){f(I);var H=a(A);var J=a(o);J.StackTrace=I.stack||"";if(I.type){J.ExceptionType=I.type}J.ExceptionMessage=I.message;H.Exceptions.push(J);m(H);if(C.onBeforeStore){C.onBeforeStore(H)}w.push(H)};var h=function(){if(w.length&&v&&!navigator.onLine){g("No connection found, stored reports to localStorage");j();w=[];return}var J={Slug:C.slug,ModuleVersion:"1.0.0.0",ApplicationType:"Javascript",FailOccurrences:[]};while(w.length){var I=w.shift();J.FailOccurrences.push(I)}w.length=0;var H=new Image();H.src=C.appfailApiRoot+"/JsFail/v1?json="+encodeURIComponent(JSON.stringify(J))};var j=function(){if(B){var K=window.localStorage.getItem("appfail-errors");if(K!==""&&K!==null){var I=JSON.parse(K);for(var J=0,H=I.length;J<H;J++){w.push(I[J])}}window.localStorage.setItem("appfail-errors",JSON.stringify(w))}};var e=function(){var M;var N=window.localStorage.getItem("appfail-errors");if(N===""||N===null){return}M=JSON.parse(N);var K=+new Date();var I=86400000;var O=C.daysToStore*I;var J=[];for(var L=0,H=M.length;L<H;L++){if(K-O>M[L].OccurrenceTimeUtc){g("Dropping an old error")}else{J.push(M[L])}}w=J;window.localStorage.removeItem("appfail-errors")};var s=function(){if(appfail.config){C=l(r,appfail.config);return}var L=document.getElementsByTagName("script");var H;for(var O=0,P=L.length;O<P;O++){if(L[O].src.indexOf("appfail.reporting.min.js")>-1){H=L[O];break}}if(H.src.indexOf("?")===-1){return}var I=H.src.split("?")[1];var J=I.split("&");var K={};for(var M=0,Q=J.length;M<Q;M++){var N=J[M].split("=");K[N[0]]=N[1]}C=l(r,K)};function z(I){var H=new RegExp("[?&]"+I+"=([^&]*)").exec(window.location.search);return H&&decodeURIComponent(H[1].replace(/\+/g," "))}(function(){s();if(!C.slug){g("No application slug was found.");return}if(v&&navigator.onLine){e()}d();if(z("appfail-report-test-exception")){try{throw new Error("This is an Appfail test exception. Congratulations, your web-site is successfully reporting javascript errors to Appfail")}catch(H){k(H)}}})();var g=function(H){if(console&&console.error){console.error("appfail: "+H)}};var D=function(){f("hasOnlineBool: ",v);f("hasOfflineEvents: ",F);f("hasJSON: ",B);f("hasLocalStorage: ",y)};return{catchManual:k,processQueue:h,storeQueue:j,loadStoredErrors:e,runTests:D}})();